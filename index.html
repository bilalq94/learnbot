</div>
                <div className="bg-white bg-opacity-10 rounded-xl p-4">
                  <div className={`text-3xl font-black ${getTextClass()}`}>{streak}</div>
                  <div className={`${getTextClass()} opacity-75 text-sm`}>Day Streak</div>
                </div>
                <div className="bg-white bg-opacity-10 rounded-xl p-4">
                  <div className={`text-3xl font-black ${getTextClass()}`}>{sessions.length}</div>
                  <div className={`${getTextClass()} opacity-75 text-sm`}>Sessions</div>
                </div>
              </div>

              {/* Today's Progress */}
              <div className="bg-white bg-opacity-10 rounded-xl p-6 mb-6">
                <h3 className={`text-xl font-bold ${getTextClass()} mb-4`}>Today's Goal</h3>
                <div className="w-full bg-white bg-opacity-20 rounded-full h-4 mb-2">
                  <div 
                    className="bg-gradient-to-r from-green-400 to-emerald-500 h-4 rounded-full transition-all"
                    style={{ width: `${Math.min((weeklyMinutes / (weeklyTarget * 60)) * 100, 100)}%` }}
                    role="progressbar"
                    aria-valuenow={Math.min((weeklyMinutes / (weeklyTarget * 60)) * 100, 100)}
                    aria-valuemin={0}
                    aria-valuemax={100}
                  />
                </div>
                <p className={`${getTextClass()} opacity-75 text-sm`}>
                  {weeklyMinutes} / {weeklyTarget * 60} minutes this week
                </p>
              </div>

              {/* Upcoming Deadlines */}
              {deadlines.filter(d => !d.completed).slice(0, 3).length > 0 && (
                <div className="bg-white bg-opacity-10 rounded-xl p-6">
                  <h3 className={`text-xl font-bold ${getTextClass()} mb-4`}>Upcoming Deadlines</h3>
                  <div className="space-y-2">
                    {deadlines
                      .filter(d => !d.completed)
                      .sort((a, b) => new Date(a.date) - new Date(b.date))
                      .slice(0, 3)
                      .map(deadline => (
                        <div key={deadline.id} className="flex justify-between items-center">
                          <span className={getTextClass()}>{sanitizeHTML(deadline.title)}</span>
                          <span className={`${getTextClass()} opacity-75 text-sm`}>
                            {new Date(deadline.date).toLocaleDateString()}
                          </span>
                        </div>
                      ))}
                  </div>
                </div>
              )}
            </div>
          )}

          {/* TIMER TAB */}
          {tab === 'timer' && (
            <div className={`${getCardClass()} rounded-2xl p-6 text-center`}>
              <h2 className={`text-3xl font-bold ${getTextClass()} mb-6`}>
                {getModeLabel('timer', appMode)}
              </h2>

              {/* Course Selector */}
              <select
                value={selectedCourse}
                onChange={(e) => setSelectedCourse(e.target.value)}
                className="w-full max-w-md mx-auto mb-6 px-4 py-3 rounded-lg bg-white bg-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400"
                aria-label={`Select ${getModeLabel('course', appMode).toLowerCase()}`}
              >
                <option value="">Select {getModeLabel('course', appMode)}</option>
                {courses.map(course => (
                  <option key={course.id} value={course.name}>
                    {sanitizeHTML(course.name)}
                  </option>
                ))}
              </select>

              {/* Timer Display */}
              <div className={`text-8xl font-black ${getTextClass()} mb-8`}>
                {Math.floor(time / 60).toString().padStart(2, '0')}:
                {(time % 60).toString().padStart(2, '0')}
              </div>

              {/* Duration Selector */}
              <div className="flex justify-center gap-2 mb-8">
                {[15, 25, 30, 45, 60].map(mins => (
                  <button
                    key={mins}
                    onClick={() => { setDuration(mins); announceToScreenReader(`Duration set to ${mins} minutes`); }}
                    disabled={running}
                    className={`px-4 py-2 rounded-lg font-bold transition-all ${
                      duration === mins
                        ? 'bg-white text-cyan-600'
                        : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                    }`}
                    aria-label={`Set timer to ${mins} minutes`}
                    aria-pressed={duration === mins}
                  >
                    {mins}m
                  </button>
                ))}
              </div>

              {/* Timer Controls */}
              <div className="flex justify-center gap-4">
                {!running ? (
                  <button
                    onClick={startTimer}
                    className="bg-gradient-to-r from-green-500 to-emerald-500 text-white px-8 py-4 rounded-xl font-bold text-xl hover:scale-105 transition-all flex items-center gap-2"
                    aria-label="Start timer"
                  >
                    <Icon name="play" ariaLabel="Play icon" />
                    Start
                  </button>
                ) : (
                  <>
                    <button
                      onClick={pauseTimer}
                      className="bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-8 py-4 rounded-xl font-bold text-xl hover:scale-105 transition-all flex items-center gap-2"
                      aria-label="Pause timer"
                    >
                      <Icon name="pause" ariaLabel="Pause icon" />
                      Pause
                    </button>
                    <button
                      onClick={stopTimer}
                      className="bg-gradient-to-r from-red-500 to-pink-500 text-white px-8 py-4 rounded-xl font-bold text-xl hover:scale-105 transition-all flex items-center gap-2"
                      aria-label="Stop timer"
                    >
                      <Icon name="square" ariaLabel="Stop icon" />
                      Stop
                    </button>
                  </>
                )}
              </div>

              {/* Lofi Music Player */}
              <div className="mt-8 pt-8 border-t border-white border-opacity-20">
                <h3 className={`text-xl font-bold ${getTextClass()} mb-4`}>Background Music</h3>
                
                <div className="max-w-md mx-auto space-y-4">
                  <div className="flex items-center justify-between">
                    <span className={getTextClass()}>Enable Music</span>
                    <button
                      onClick={() => setLofiEnabled(!lofiEnabled)}
                      className={`w-12 h-6 rounded-full transition-colors ${
                        lofiEnabled ? 'bg-green-500' : 'bg-gray-500'
                      }`}
                      role="switch"
                      aria-checked={lofiEnabled}
                      aria-label="Toggle background music"
                    >
                      <div className={`w-5 h-5 bg-white rounded-full transition-transform ${
                        lofiEnabled ? 'translate-x-6' : 'translate-x-1'
                      }`} />
                    </button>
                  </div>

                  {lofiEnabled && (
                    <>
                      <select
                        value={lofiStream}
                        onChange={(e) => setLofiStream(e.target.value)}
                        className="w-full px-4 py-2 rounded-lg bg-white bg-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400"
                        aria-label="Select music station"
                      >
                        <optgroup label="Lofi & Chill">
                          <option value="lofi-girl">Lofi Girl</option>
                          <option value="chillhop">Chillhop</option>
                          <option value="jazz-cafe">Jazz Caf√©</option>
                          <option value="study-md">Study MD</option>
                        </optgroup>
                        <optgroup label="Quran Recitation">
                          <option value="quran-mishary">Mishary Rashid</option>
                          <option value="quran-sudais">Sheikh Sudais</option>
                          <option value="quran-shuraim">Sheikh Shuraim</option>
                          <option value="quran-maher">Maher Al Muaiqly</option>
                        </optgroup>
                      </select>

                      <div>
                        <label className={`block mb-2 ${getTextClass()}`}>
                          Volume: {lofiVolume}%
                        </label>
                        <input
                          type="range"
                          min="0"
                          max="100"
                          value={lofiVolume}
                          onChange={(e) => setLofiVolume(Number(e.target.value))}
                          className="w-full"
                          aria-label="Music volume"
                        />
                      </div>

                      <div className="aspect-video bg-black rounded-lg overflow-hidden">
                        <iframe
                          ref={lofiPlayerRef}
                          src={getLofiStreamUrl()}
                          className="w-full h-full"
                          allow="autoplay"
                          title="Background music player"
                        />
                      </div>
                    </>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* COURSES TAB */}
          {tab === 'courses' && (
            <div className={`${getCardClass()} rounded-2xl p-6`}>
              <h2 className={`text-3xl font-bold ${getTextClass()} mb-6`}>
                My {getModeLabel('courses', appMode)}
              </h2>

              {/* Add Course */}
              <div className="flex gap-2 mb-6">
                <input
                  type="text"
                  placeholder={`New ${getModeLabel('course', appMode).toLowerCase()}...`}
                  value={newCourse}
                  onChange={(e) => setNewCourse(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && addCourse()}
                  className="flex-1 px-4 py-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-50 focus:outline-none focus:ring-2 focus:ring-cyan-400"
                  maxLength={50}
                  aria-label={`Add new ${getModeLabel('course', appMode).toLowerCase()}`}
                />
                <button
                  onClick={addCourse}
                  className="bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-3 rounded-lg font-bold hover:scale-105 transition-all"
                  aria-label={getModeLabel('add', appMode)}
                >
                  <Icon name="plus" ariaLabel="Add icon" />
                </button>
              </div>

              {/* Course List */}
              {courses.length === 0 ? (
                <div className="text-center py-12">
                  <div className="text-6xl mb-4">üìö</div>
                  <p className={`${getTextClass()} opacity-75`}>
                    No {getModeLabel('courses', appMode).toLowerCase()} yet. Add one above!
                  </p>
                </div>
              ) : (
                <div className="grid md:grid-cols-2 gap-4">
                  {courses.map(course => {
                    const courseMinutes = sessions
                      .filter(s => s.course === course.name)
                      .reduce((sum, s) => sum + s.duration, 0);
                    
                    return (
                      <div
                        key={course.id}
                        className="bg-white bg-opacity-10 rounded-xl p-4 hover:bg-opacity-20 transition-all"
                      >
                        <div className="flex justify-between items-start mb-2">
                          <h3 className={`text-xl font-bold ${getTextClass()}`}>
                            {sanitizeHTML(course.name)}
                          </h3>
                          <button
                            onClick={() => deleteCourse(course.id)}
                            className="text-red-400 hover:text-red-300"
                            aria-label={`Delete ${course.name}`}
                          >
                            <Icon name="x" ariaLabel="Delete icon" />
                          </button>
                        </div>
                        <div className={`${getTextClass()} opacity-75 text-sm`}>
                          {Math.floor(courseMinutes / 60)}h {courseMinutes % 60}m studied
                        </div>
                        <div className={`${getTextClass()} opacity-75 text-sm`}>
                          {sessions.filter(s => s.course === course.name).length} sessions
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          )}

          {/* DEADLINES TAB */}
          {tab === 'deadlines' && (
            <div className={`${getCardClass()} rounded-2xl p-6`}>
              <div className="flex justify-between items-center mb-6">
                <h2 className={`text-3xl font-bold ${getTextClass()}`}>Deadlines</h2>
                <button
                  onClick={() => setShowAddDeadline(!showAddDeadline)}
                  className="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-lg font-bold hover:scale-105 transition-all"
                  aria-label={showAddDeadline ? "Cancel add deadline" : "Add new deadline"}
                >
                  {showAddDeadline ? 'Cancel' : '+ Add Deadline'}
                </button>
              </div>

              {/* Add Deadline Form */}
              {showAddDeadline && (
                <div className="bg-white bg-opacity-10 rounded-xl p-4 mb-6">
                  <h3 className={`${getTextClass()} font-bold mb-3`}>New Deadline</h3>
                  <div className="space-y-3">
                    <input
                      type="text"
                      placeholder="Title (e.g., Final Exam)"
                      value={newDeadline.title}
                      onChange={(e) => setNewDeadline({ ...newDeadline, title: e.target.value })}
                      className="w-full px-4 py-2 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-50 focus:outline-none focus:ring-2 focus:ring-cyan-400"
                      maxLength={100}
                      aria-label="Deadline title"
                    />
                    <select
                      value={newDeadline.course}
                      onChange={(e) => setNewDeadline({ ...newDeadline, course: e.target.value })}
                      className="w-full px-4 py-2 rounded-lg bg-white bg-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400"
                      aria-label={`Select ${getModeLabel('course', appMode).toLowerCase()}`}
                    >
                      <option value="">Select {getModeLabel('course', appMode)} (Optional)</option>
                      {courses.map(course => (
                        <option key={course.id} value={course.name}>
                          {sanitizeHTML(course.name)}
                        </option>
                      ))}
                    </select>
                    <input
                      type="date"
                      value={newDeadline.date}
                      onChange={(e) => setNewDeadline({ ...newDeadline, date: e.target.value })}
                      className="w-full px-4 py-2 rounded-lg bg-white bg-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400"
                      aria-label="Due date"
                    />
                    <select
                      value={newDeadline.type}
                      onChange={(e) => setNewDeadline({ ...newDeadline, type: e.target.value })}
                      className="w-full px-4 py-2 rounded-lg bg-white bg-opacity-20 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400"
                      aria-label="Deadline type"
                    >
                      <option value="assignment">Assignment</option>
                      <option value="exam">Exam</option>
                      <option value="project">Project</option>
                      <option value="other">Other</option>
                    </select>
                    <div className="flex gap-2">
                      <button
                        onClick={addDeadline}
                        className="flex-1 bg-green-500 text-white py-2 rounded-lg font-bold hover:bg-green-600"
                        aria-label="Save deadline"
                      >
                        Save
                      </button>
                      <button
                        onClick={() => { setShowAddDeadline(false); setNewDeadline({ course: '', title: '', date: '', type: 'assignment' }); }}
                        className="flex-1 bg-gray-500 text-white py-2 rounded-lg font-bold hover:bg-gray-600"
                        aria-label="Cancel"
                      >
                        Cancel
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* Deadlines List */}
              {deadlines.length === 0 ? (
                <div className="text-center py-12">
                  <div className="text-6xl mb-4">üìÖ</div>
                  <p className={`${getTextClass()} opacity-75`}>
                    No deadlines yet. Add one above!
                  </p>
                </div>
              ) : (
                <div className="space-y-4">
                  {/* Upcoming */}
                  {deadlines.filter(d => !d.completed).length > 0 && (
                    <>
                      <h3 className={`text-xl font-bold ${getTextClass()} mb-3`}>Upcoming</h3>
                      {deadlines
                        .filter(d => !d.completed)
                        .sort((a, b) => new Date(a.date) - new Date(b.date))
                        .map(deadline => {
                          const daysUntil = Math.ceil((new Date(deadline.date) - new Date()) / (1000 * 60 * 60 * 24));
                          const urgencyClass = daysUntil < 0 ? 'bg-red-500' : daysUntil <= 3 ? 'bg-orange-500' : daysUntil <= 7 ? 'bg-yellow-500' : 'bg-green-500';
                          
                          return (
                            <div
                              key={deadline.id}
                              className={`${urgencyClass} bg-opacity-20 border-2 ${urgencyClass.replace('bg-', 'border-')} rounded-xl p-4`}
                            >
                              <div className="flex justify-between items-start mb-2">
                                <div className="flex-1">
                                  <h4 className={`font-bold text-lg ${getTextClass()}`}>
                                    {sanitizeHTML(deadline.title)}
                                  </h4>
                                  {deadline.course && (
                                    <p className={`${getTextClass()} opacity-75 text-sm`}>
                                      {sanitizeHTML(deadline.course)}
                                    </p>
                                  )}
                                </div>
                                <div className="text-right">
                                  <div className={`font-bold ${getTextClass()}`}>
                                    {daysUntil < 0 
                                      ? `${Math.abs(daysUntil)} days overdue` 
                                      : daysUntil === 0 
                                      ? 'Due today!' 
                                      : daysUntil === 1 
                                      ? 'Due tomorrow' 
                                      : `${daysUntil} days`}
                                  </div>
                                  <div className={`${getTextClass()} opacity-75 text-sm`}>
                                    {new Date(deadline.date).toLocaleDateString()}
                                  </div>
                                </div>
                              </div>
                              <div className="flex gap-2">
                                <button
                                  onClick={() => toggleDeadline(deadline.id)}
                                  className="bg-white bg-opacity-20 px-4 py-1 rounded-lg text-sm font-semibold hover:bg-opacity-30 text-white"
                                  aria-label={`Mark ${deadline.title} as complete`}
                                >
                                  ‚úì Mark Complete
                                </button>
                                <button
                                  onClick={() => deleteDeadline(deadline.id)}
                                  className="bg-white bg-opacity-20 px-4 py-1 rounded-lg text-sm font-semibold hover:bg-opacity-30 text-white"
                                  aria-label={`Delete ${deadline.title}`}
                                >
                                  Delete
                                </button>
                              </div>
                            </div>
                          );
                        })}
                    </>
                  )}

                  {/* Completed */}
                  {deadlines.filter(d => d.completed).length > 0 && (
                    <>
                      <h3 className={`text-xl font-bold ${getTextClass()} mb-3 mt-6`}>Completed ‚úì</h3>
                      {deadlines
                        .filter(d => d.completed)
                        .map(deadline => (
                          <div
                            key={deadline.id}
                            className="bg-white bg-opacity-10 rounded-xl p-3 opacity-60"
                          >
                            <div className="flex justify-between items-center">
                              <div>
                                <h4 className={`font-bold ${getTextClass()} line-through`}>
                                  {sanitizeHTML(deadline.title)}
                                </h4>
                                {deadline.course && (
                                  <p className={`${getTextClass()} opacity-75 text-sm`}>
                                    {sanitizeHTML(deadline.course)}
                                  </p>
                                )}
                              </div>
                              <div className="flex gap-2">
                                <button
                                  onClick={() => toggleDeadline(deadline.id)}
                                  className="bg-white bg-opacity-20 px-3 py-1 rounded-lg text-sm text-white hover:bg-opacity-30"
                                  aria-label="Mark as incomplete"
                                >
                                  Undo
                                </button>
                                <button
                                  onClick={() => deleteDeadline(deadline.id)}
                                  className="bg-white bg-opacity-20 px-3 py-1 rounded-lg text-sm text-white hover:bg-opacity-30"
                                  aria-label="Delete"
                                >
                                  Delete
                                </button>
                              </div>
                            </div>
                          </div>
                        ))}
                    </>
                  )}
                </div>
              )}
            </div>
          )}

          {/* LEADERBOARD TAB */}
          {tab === 'leaderboard' && (
            <div className={`${getCardClass()} rounded-2xl p-6`}>
              <h2 className={`text-3xl font-bold ${getTextClass()} mb-6`}>
                {getModeLabel('leaderboard', appMode)}
              </h2>

              {!username ? (
                <div className="text-center py-12">
                  <div className="text-6xl mb-4">üèÜ</div>
                  <p className={`${getTextClass()} mb-6`}>
                    Set a username to join the leaderboard!
                  </p>
                  <input
                    type="text"
                    placeholder="Choose username"
                    value={tempUsername}
                    onChange={(e) => setTempUsername(e.target.value)}
                    className="w-full max-w-xs mx-auto mb-4 px-4 py-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-50 focus:outline-none focus:ring-2 focus:ring-cyan-400"
                    maxLength={20}
                    aria-label="Choose username"
                  />
                  <button
                    onClick={saveUsername}
                    className="bg-gradient-to-r from-cyan-500 to-blue-500 text-white px-6 py-3 rounded-lg font-bold hover:scale-105 transition-all"
                    aria-label="Save username"
                  >
                    Save Username
                  </button>
                </div>
              ) : (
                <>
                  {/* Type Toggle */}
                  <div className="flex gap-2 mb-6 justify-center">
                    <button
                      onClick={() => setLeaderboardType('weekly')}
                      className={`px-6 py-2 rounded-lg font-bold transition-all ${
                        leaderboardType === 'weekly'
                          ? 'bg-white text-cyan-600'
                          : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                      }`}
                      aria-label="Show weekly leaderboard"
                      aria-pressed={leaderboardType === 'weekly'}
                    >
                      This Week
                    </button>
                    <button
                      onClick={() => setLeaderboardType('alltime')}
                      className={`px-6 py-2 rounded-lg font-bold transition-all ${
                        leaderboardType === 'alltime'
                          ? 'bg-white text-cyan-600'
                          : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                      }`}
                      aria-label="Show all-time leaderboard"
                      aria-pressed={leaderboardType === 'alltime'}
                    >
                      All Time
                    </button>
                  </div>

                  {/* Leaderboard List */}
                  {loadingLeaderboard ? (
                    <div className="text-center py-12">
                      <div className="text-4xl mb-4 animate-spin">‚è≥</div>
                      <p className={getTextClass()}>Loading leaderboard...</p>
                    </div>
                  ) : leaderboardData.length === 0 ? (
                    <div className="text-center py-12">
                      <div className="text-6xl mb-4">üèÜ</div>
                      <p className={`${getTextClass()} opacity-75`}>
                        No leaderboard data yet. Be the first!
                      </p>
                    </div>
                  ) : (
                    <div className="space-y-2">
                      {leaderboardData.map((userData, index) => {
                        const minutes = leaderboardType === 'weekly'
                          ? calculateUserWeeklyMinutes(userData)
                          : userData.totalMinutes || 0;
                        const isCurrentUser = userData.id === user.uid;
                        
                        return (
                          <div
                            key={userData.id}
                            className={`flex items-center gap-4 p-4 rounded-xl transition-all ${
                              isCurrentUser 
                                ? 'bg-cyan-500 bg-opacity-30 ring-2 ring-cyan-400' 
                                : 'bg-white bg-opacity-10 hover:bg-opacity-20'
                            }`}
                          >
                            <div className={`text-2xl font-black ${getTextClass()} w-8`}>
                              {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `#${index + 1}`}
                            </div>
                            <div className="flex-1">
                              <div className={`font-bold ${getTextClass()}`}>
                                {sanitizeHTML(userData.username || 'Anonymous')}
                                {isCurrentUser && ' (You)'}
                              </div>
                              <div className={`${getTextClass()} opacity-75 text-sm`}>
                                Level {getLevel(userData.xp || 0)}
                              </div>
                            </div>
                            <div className={`text-right ${getTextClass()}`}>
                              <div className="font-bold">{Math.floor(minutes / 60)}h {minutes % 60}m</div>
                              <div className="opacity-75 text-sm">{userData.xp || 0} {getModeLabel('xp', appMode)}</div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  )}
                </>
              )}
            </div>
          )}

          {/* STATS TAB */}
          {tab === 'stats' && (
            <div className={`${getCardClass()} rounded-2xl p-6`}>
              <h2 className={`text-3xl font-bold ${getTextClass()} mb-6`}>Statistics</h2>

              {/* Overall Stats */}
              <div className="grid md:grid-cols-3 gap-4 mb-8">
                <div className="bg-white bg-opacity-10 rounded-xl p-6">
                  <div className={`text-4xl font-black ${getTextClass()}`}>
                    {Math.floor(totalMinutes / 60)}h
                  </div>
                  <div className={`${getTextClass()} opacity-75`}>Total Study Time</div>
                </div>
                <div className="bg-white bg-opacity-10 rounded-xl p-6">
                  <div className={`text-4xl font-black ${getTextClass()}`}>
                    {sessions.length}
                  </div>
                  <div className={`${getTextClass()} opacity-75`}>Sessions Completed</div>
                </div>
                <div className="bg-white bg-opacity-10 rounded-xl p-6">
                  <div className={`text-4xl font-black ${getTextClass()}`}>
                    {longestStreak}
                  </div>
                  <div className={`${getTextClass()} opacity-75`}>Longest Streak</div>
                </div>
              </div>

              {/* Skills Breakdown */}
              {skills.length > 0 && (
                <>
                  <h3 className={`text-2xl font-bold ${getTextClass()} mb-4`}>
                    {getModeLabel('course', appMode)} Levels
                  </h3>
                  <div className="space-y-3 mb-8">
                    {skills
                      .sort((a, b) => b.level - a.level)
                      .map(skill => (
                        <div key={skill.name} className="bg-white bg-opacity-10 rounded-xl p-4">
                          <div className="flex justify-between items-center mb-2">
                            <span className={`font-bold ${getTextClass()}`}>
                              {sanitizeHTML(skill.name)}
                            </span>
                            <span className={`${getTextClass()} opacity-75`}>
                              Level {skill.level}
                            </span>
                          </div>
                          <div className="w-full bg-white bg-opacity-20 rounded-full h-2">
                            <div 
                              className="bg-gradient-to-r from-cyan-400 to-blue-500 h-2 rounded-full"
                              style={{ width: `${((skill.minutes % 60) / 60) * 100}%` }}
                              role="progressbar"
                              aria-valuenow={(skill.minutes % 60)}
                              aria-valuemin={0}
                              aria-valuemax={60}
                              aria-label={`Progress to next level: ${skill.minutes % 60} of 60 minutes`}
                            />
                          </div>
                          <div className={`${getTextClass()} opacity-75 text-sm mt-1`}>
                            {skill.minutes % 60}/60 minutes to Level {skill.level + 1}
                          </div>
                        </div>
                      ))}
                  </div>
                </>
              )}

              {/* Recent Sessions */}
              <h3 className={`text-2xl font-bold ${getTextClass()} mb-4`}>Recent Sessions</h3>
              {sessions.length === 0 ? (
                <div className="text-center py-12">
                  <p className={`${getTextClass()} opacity-75`}>No sessions yet. Start studying!</p>
                </div>
              ) : (
                <div className="space-y-2">
                  {sessions
                    .slice(-10)
                    .reverse()
                    .map(session => (
                      <div
                        key={session.id}
                        className="flex justify-between items-center bg-white bg-opacity-10 rounded-lg p-3"
                      >
                        <div>
                          <div className={`font-semibold ${getTextClass()}`}>
                            {sanitizeHTML(session.course)}
                          </div>
                          <div className={`${getTextClass()} opacity-75 text-sm`}>
                            {new Date(session.timestamp).toLocaleDateString()}
                          </div>
                        </div>
                        <div className="text-right">
                          <div className={`font-bold ${getTextClass()}`}>
                            {session.duration} min
                          </div>
                          <div className={`${getTextClass()} opacity-75 text-sm`}>
                            +{session.xpEarned} {getModeLabel('xp', appMode)}
                          </div>
                        </div>
                      </div>
                    ))}
                </div>
              )}
            </div>
          )}
        </main>

        {/* Floating Action Buttons - NOTES ONLY */}
        <div className="fixed bottom-6 right-6 flex flex-col gap-3 z-30">
          <button
            onClick={() => setShowNotesPanel(!showNotesPanel)}
            className={`${showNotesPanel ? 'bg-yellow-500' : 'bg-gray-800'} text-white w-14 h-14 rounded-full shadow-lg hover:scale-110 transition-all flex items-center justify-center text-2xl`}
            aria-label={showNotesPanel ? "Close notes panel" : "Open notes panel"}
            aria-expanded={showNotesPanel}
          >
            üìù
          </button>
        </div>

        {/* Sticky Notes Panel */}
        {showNotesPanel && (
          <div 
            className="fixed inset-0 bg-black bg-opacity-50 z-40 p-4 overflow-auto"
            onClick={(e) => e.target === e.currentTarget && setShowNotesPanel(false)}
            role="dialog"
            aria-labelledby="notes-title"
            aria-modal="true"
          >
            <div className="max-w-4xl mx-auto">
              <div className={`${getCardClass()} rounded-2xl p-6 mb-4`}>
                <div className="flex justify-between items-center mb-4">
                  <h3 id="notes-title" className={`text-2xl font-bold ${getTextClass()}`}>
                    Sticky Notes
                  </h3>
                  <div className="flex gap-2">
                    <button
                      onClick={addStickyNote}
                      disabled={stickyNotes.length >= 50}
                      className="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg font-bold disabled:opacity-50"
                      aria-label="Add new note"
                    >
                      + New Note
                    </button>
                    <button
                      onClick={() => setShowNotesPanel(false)}
                      className="text-white opacity-75 hover:opacity-100"
                      aria-label="Close notes panel"
                    >
                      <Icon name="x" ariaLabel="Close icon" />
                    </button>
                  </div>
                </div>

                {stickyNotes.length === 0 ? (
                  <div className="text-center py-12">
                    <div className="text-6xl mb-4">üìù</div>
                    <p className={`${getTextClass()} opacity-75`}>
                      No notes yet. Click "New Note" to add one!
                    </p>
                  </div>
                ) : (
                  <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {stickyNotes.map(note => (
                      <div
                        key={note.id}
                        className={`bg-${note.color}-200 p-4 rounded-lg shadow-lg`}
                      >
                        {/* Color Picker */}
                        <div className="flex justify-between mb-2">
                          <div className="flex gap-1">
                            {['yellow', 'pink', 'blue', 'green'].map(color => (
                              <button
                                key={color}
                                onClick={() => changeNoteColor(note.id, color)}
                                className={`w-5 h-5 rounded-full bg-${color}-300 ${
                                  note.color === color ? 'ring-2 ring-gray-800' : ''
                                }`}
                                aria-label={`Change note color to ${color}`}
                              />
                            ))}
                          </div>
                          <button
                            onClick={() => deleteStickyNote(note.id)}
                            className="text-gray-600 hover:text-red-600 font-bold"
                            aria-label="Delete note"
                          >
                            √ó
                          </button>
                        </div>

                        {/* Note Content */}
                        <textarea
                          value={note.text}
                          onChange={(e) => updateStickyNote(note.id, e.target.value)}
                          placeholder="Write a note..."
                          className="w-full bg-transparent border-none focus:outline-none resize-none text-gray-800 min-h-[100px]"
                          maxLength={500}
                          aria-label="Note text"
                        />

                        {/* Character Counter */}
                        <div className="text-xs text-gray-600 text-right mt-1">
                          {note.text.length} / 500
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>
          </div>
        )}

        {/* Menu Panel */}
        {showMenu && (
          <div 
            className="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-end"
            onClick={(e) => e.target === e.currentTarget && setShowMenu(false)}
            role="dialog"
            aria-labelledby="menu-title"
            aria-modal="true"
          >
            <div className={`${getCardClass()} w-full max-w-md h-full overflow-y-auto p-6`}>
              <div className="flex justify-between items-center mb-6">
                <h2 id="menu-title" className={`text-2xl font-bold ${getTextClass()}`}>
                  Settings
                </h2>
                <button
                  onClick={() => setShowMenu(false)}
                  className={getTextClass()}
                  aria-label="Close menu"
                >
                  <Icon name="x" ariaLabel="Close icon" />
                </button>
              </div>

              {/* App Mode Switcher */}
              <div className="bg-white bg-opacity-10 rounded-xl p-4 mb-4">
                <h3 className={`font-bold ${getTextClass()} mb-3`}>App Mode</h3>
                <div className="flex gap-2">
                  <button
                    onClick={() => { 
                      setAppMode('education'); 
                      announceToScreenReader('Switched to Education mode');
                    }}
                    className={`flex-1 px-4 py-2 rounded-lg font-bold transition-all ${
                      appMode === 'education'
                        ? 'bg-white text-cyan-600'
                        : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                    }`}
                    aria-label="Switch to Education mode"
                    aria-pressed={appMode === 'education'}
                  >
                    üéì Education
                  </button>
                  <button
                    onClick={() => { 
                      setAppMode('enterprise'); 
                      announceToScreenReader('Switched to Enterprise mode');
                    }}
                    className={`flex-1 px-4 py-2 rounded-lg font-bold transition-all ${
                      appMode === 'enterprise'
                        ? 'bg-white text-cyan-600'
                        : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                    }`}
                    aria-label="Switch to Enterprise mode"
                    aria-pressed={appMode === 'enterprise'}
                  >
                    üíº Enterprise
                  </button>
                </div>
              </div>

              {/* Profile */}
              <div className="bg-white bg-opacity-10 rounded-xl p-4 mb-4">
                <h3 className={`font-bold ${getTextClass()} mb-3`}>Profile</h3>
                <div className={`${getTextClass()} mb-2`}>
                  <strong>Name:</strong> {sanitizeHTML(name)}
                </div>
                <div className={`${getTextClass()} mb-2`}>
                  <strong>Email:</strong> {sanitizeHTML(email)}
                </div>
                <div className={`${getTextClass()} mb-2`}>
                  <strong>Username:</strong> {sanitizeHTML(username) || 'Not set'}
                </div>
                <div className={`${getTextClass()}`}>
                  <strong>Status:</strong> {isPro ? 'üëë Pro' : 'Free'}
                </div>
              </div>

              {/* Theme Customization */}
              <div className="bg-white bg-opacity-10 rounded-xl p-4 mb-4">
                <h3 className={`font-bold ${getTextClass()} mb-3`}>Theme</h3>
                
                <label className={`block ${getTextClass()} mb-2`}>Mode</label>
                <div className="flex gap-2 mb-4">
                  {['dark', 'light'].map(mode => (
                    <button
                      key={mode}
                      onClick={() => setThemeMode(mode)}
                      className={`flex-1 px-4 py-2 rounded-lg font-bold capitalize transition-all ${
                        themeMode === mode
                          ? 'bg-white text-cyan-600'
                          : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                      }`}
                      aria-label={`Switch to ${mode} mode`}
                      aria-pressed={themeMode === mode}
                    >
                      {mode}
                    </button>
                  ))}
                </div>

                <label className={`block ${getTextClass()} mb-2`}>Color</label>
                <div className="grid grid-cols-4 gap-2">
                  {[
                    { name: 'cyan', class: 'bg-cyan-500' },
                    { name: 'purple', class: 'bg-purple-500' },
                    { name: 'green', class: 'bg-green-500' },
                    { name: 'orange', class: 'bg-orange-500' }
                  ].map(({ name, class: colorClass }) => (
                    <button
                      key={name}
                      onClick={() => setColorTheme(name)}
                      className={`${colorClass} h-12 rounded-lg ${
                        colorTheme === name ? 'ring-4 ring-white' : ''
                      }`}
                      aria-label={`Switch to ${name} color theme`}
                      aria-pressed={colorTheme === name}
                    />
                  ))}
                </div>
              </div>

              {/* Upgrade to Pro */}
              {!isPro && (
                <button
                  onClick={handleUpgrade}
                  disabled={paymentProcessing}
                  className="w-full bg-gradient-to-r from-yellow-400 to-orange-400 text-white py-3 rounded-xl font-bold hover:scale-105 transition-all mb-4"
                  aria-label="Upgrade to Pro"
                  aria-busy={paymentProcessing}
                >
                  {paymentProcessing ? 'Processing...' : 'üëë Upgrade to Pro - $5'}
                </button>
              )}

              {/* Feedback */}
              <button
                onClick={() => { setShowFeedback(true); setShowMenu(false); }}
                className="w-full bg-white bg-opacity-20 hover:bg-opacity-30 text-white py-3 rounded-xl font-bold mb-4"
                aria-label="Send feedback"
              >
                üí¨ Send Feedback
              </button>

              {/* Logout */}
              <button
                onClick={logout}
                className="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2"
                aria-label="Log out"
              >
                <Icon name="logout" ariaLabel="Logout icon" />
                Logout
              </button>
            </div>
          </div>
        )}

        {/* Completion Alert */}
        {showDone && (
          <CompletionAlert
            earnedXp={earnedXp}
            onClose={() => setShowDone(false)}
            course={selectedCourse}
            duration={duration}
            level={getLevel(xp)}
            totalXp={xp}
            streak={streak}
            isNewStreak={streak > 1}
            isMilestone={[7, 30, 100, 365].includes(streak)}
            appMode={appMode}
          />
        )}

        {/* Streak Lost Alert */}
        {showStreakLost && (
          <div 
            className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
            role="alert"
            aria-live="assertive"
          >
            <div className="bg-red-600 rounded-2xl p-8 max-w-md text-center">
              <div className="text-6xl mb-4">üíî</div>
              <h3 className="text-3xl font-bold text-white mb-2">
                Streak Lost!
              </h3>
              <p className="text-white text-lg mb-6">
                You lost your {lostStreakCount}-day streak. Start a new one today!
              </p>
              <button
                onClick={() => setShowStreakLost(false)}
                className="bg-white text-red-600 px-6 py-3 rounded-xl font-bold hover:scale-105 transition-all"
                aria-label="Close alert"
              >
                Got It
              </button>
            </div>
          </div>
        )}

        {/* Feedback Modal */}
        {showFeedback && (
          <div 
            className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
            role="dialog"
            aria-labelledby="feedback-title"
            aria-modal="true"
          >
            <div className={`${getCardClass()} rounded-2xl p-8 max-w-md w-full`}>
              <h3 id="feedback-title" className={`text-2xl font-bold ${getTextClass()} mb-4`}>
                Send Feedback
              </h3>

              <select
                value={feedbackType}
                onChange={(e) => setFeedbackType(e.target.value)}
                className="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 text-white mb-4 focus:outline-none focus:ring-2 focus:ring-cyan-400"
                aria-label="Feedback type"
              >
                <option value="feature">Feature Request</option>
                <option value="bug">Bug Report</option>
                <option value="other">Other</option>
              </select>

              <textarea
                value={feedbackText}
                onChange={(e) => setFeedbackText(e.target.value)}
                placeholder="Tell us what you think..."
                className="w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-50 h-32 mb-4 focus:outline-none focus:ring-2 focus:ring-cyan-400"
                maxLength={1000}
                aria-label="Feedback message"
              />

              <div className="flex gap-3">
                <button
                  onClick={submitFeedback}
                  disabled={feedbackSubmitting || !feedbackText.trim()}
                  className="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-bold disabled:opacity-50"
                  aria-label="Submit feedback"
                  aria-busy={feedbackSubmitting}
                >
                  {feedbackSubmitting ? 'Sending...' : 'Submit'}
                </button>
                <button
                  onClick={() => { setShowFeedback(false); setFeedbackText(''); }}
                  className="flex-1 bg-white bg-opacity-20 hover:bg-opacity-30 text-white py-3 rounded-lg font-bold"
                  aria-label="Cancel"
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Break Game Modal */}
        {showBreakGame && (
          <div 
            className="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4"
            role="dialog"
            aria-labelledby="game-title"
            aria-modal="true"
          >
            <div className="max-w-2xl w-full">
              <div className={`${getCardClass()} rounded-2xl p-6`}>
                <div className="flex justify-between items-center mb-4">
                  <h2 id="game-title" className={`text-2xl font-bold ${getTextClass()}`}>
                    Focus Trainer
                  </h2>
                  <button
                    onClick={() => { setShowBreakGame(false); setGameActive(false); }}
                    className={getTextClass()}
                    aria-label="Close game"
                  >
                    <Icon name="x" ariaLabel="Close icon" />
                  </button>
                </div>

                {gameActive ? (
                  <>
                    <div className="flex justify-between mb-4">
                      <div className={`${getTextClass()} text-xl`}>
                        Score: <strong>{gameScore}</strong>
                      </div>
                      <div className={`${getTextClass()} text-xl`}>
                        Time: <strong>{gameTime}s</strong>
                      </div>
                    </div>

                    <div className="relative bg-gray-800 rounded-xl h-96 overflow-hidden">
                      {gameTargets.map(target => (
                        <button
                          key={target.id}
                          onClick={() => clickTarget(target.id)}
                          className="absolute bg-cyan-500 rounded-full hover:bg-cyan-400 transition-colors"
                          style={{
                            left: `${target.x}%`,
                            top: `${target.y}%`,
                            width: `${target.size}px`,
                            height: `${target.size}px`
                          }}
                          aria-label="Click target"
                        />
                      ))}
                    </div>
                  </>
                ) : (
                  <div className="text-center py-12">
                    {gameScore > 0 ? (
                      <>
                        <div className="text-6xl mb-4">üéâ</div>
                        <h3 className={`text-3xl font-bold ${getTextClass()} mb-2`}>
                          Game Over!
                        </h3>
                        <p className={`${getTextClass()} text-2xl mb-4`}>
                          Score: {gameScore}
                        </p>
                        {gameScore > gameHighScore && (
                          <p className={`${getTextClass()} text-lg mb-6`}>
                            üèÜ New High Score!
                          </p>
                        )}
                      </>
                    ) : (
                      <>
                        <div className="text-6xl mb-4">üéØ</div>
                        <h3 className={`text-2xl font-bold ${getTextClass()} mb-2`}>
                          Click as many targets as you can in 60 seconds!
                        </h3>
                      </>
                    )}
                    
                    <button
                      onClick={startBreakGame}
                      className="bg-gradient-to-r from-cyan-500 to-blue-500 text-white px-8 py-4 rounded-xl font-bold text-xl hover:scale-105 transition-all"
                      aria-label={gameScore > 0 ? "Play again" : "Start game"}
                    >
                      {gameScore > 0 ? 'Play Again' : 'Start Game'}
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

// ========================================
// RENDER APP
// ========================================

ReactDOM.render(<LearnBot />, document.getElementById('root'));
  </script>
</body>
</html>
